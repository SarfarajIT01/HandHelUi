@page "/reservation"
@using System.Net.Http.Json
@using HandHelUi.Shared.Models
@using HandHelUi.Shared.Services
@using HandHelUi.Shared.Pages.Components
@inject HttpClient Http
@inject IJSRuntime JS
@inject TableSelectionService TableSelectionService


<div class="reservation-wrapper">
    <header class="reservation-header">
        <h2>Reservation</h2>
        <p>Book your table easily and manage guest reservations</p>
    </header>

    <main class="reservation-content">
        <div class="form-section">
            <button class="btn-primary" @onclick="AddNewGuest">ADD GUEST</button>

            <div class="form-row">
                <input type="text" placeholder="+91 Mobile" @bind="reservation.Phone" />
            </div>

            <div class="form-row">
                <input type="text" placeholder="Guest Name" @bind="reservation.Gname" />
            </div>

            <div class="form-row two-cols">
                <input type="text" placeholder="Table No." @bind="reservation.TblNo" />
                <input type="text" placeholder="No. of Cov" @bind="reservation.Covers" />
            </div>

            <div class="form-row two-cols">
                <input type="text" placeholder="No. of Tab" @bind="reservation.NoofTable" />
                <input type="text" placeholder="Reserve By" @bind="reservation.ResBy" />
            </div>

            <div class="form-row">
                <label>Table Comment</label>
                <textarea rows="3" @bind="reservation.TabComment"></textarea>
            </div>

            <div class="form-row two-cols">
                <input type="text" placeholder="Pos" @bind="reservation.Pos" />
                <input type="text" placeholder="Status" @bind="reservation.FinalSts" />
            </div>

            <div class="form-row two-cols">
                <input type="date" @bind="bookingDate" />
                <input type="time" @bind="bookingTime" />
            </div>
        </div>

        <div class="form-section">
            <h3>Reservation Time</h3>
            <div class="checkbox-row">
                <label><input type="checkbox" @bind="isBreakfast" /> Breakfast</label>
                <label><input type="checkbox" @bind="isLunch" /> Lunch</label>
                <label><input type="checkbox" @bind="isDinner" /> Dinner</label>
            </div>

            <div class="form-row">
                <label>Arrival Comment</label>
                <textarea rows="3" placeholder="Enter arrival details..." @bind="reservation.ArrComment"></textarea>
            </div>

            <div class="form-row">
                <label>Bill Comment</label>
                <textarea rows="3" placeholder="Enter bill comments..." @bind="reservation.BillComment"></textarea>
            </div>

            <button class="btn-reserve" @onclick="ReserveTable">RESERVE</button>
        </div>
    </main>
</div>

<!-- Guest Component -->
<Guest IsOpen=@ShowGuestPopup
       IsOpenChanged="@((val) => ShowGuestPopup = val)"
       OnGuestSelected="SelectedGuest" />

@code {
    // Model object
    PfbTableReserve reservation = new PfbTableReserve();

    // Extra UI fields
    DateTime? bookingDate;
    TimeOnly? bookingTime;
    bool isBreakfast, isLunch, isDinner;

    private bool ShowGuestPopup = false;

    // Reset form
    private void AddNewGuest()
    {
        // reservation = new PfbTableReserve();
        // bookingDate = null;
        // bookingTime = null;
        // isBreakfast = isLunch = isDinner = false;
        // Navigation.NavigateTo($"/menu/{OutletId}", forceLoad: true);

        ShowGuestPopup = true;

        TableSelectionService.TriggerGuestPopup();
    }

    private void SelectedGuest(PfbGuestDto guest)
    {
        reservation.Gname = guest.GName;
        reservation.Phone = guest.Phone1;
        reservation.Gcode = guest.GuestCode;

        // ShowGuestPopup = true;
    }

    // Send data to API
    private async Task ReserveTable()
    {
        try
        {
            // Validate required fields
            if (string.IsNullOrWhiteSpace(reservation.Gname) || string.IsNullOrWhiteSpace(reservation.Phone))
            {
                await JS.InvokeVoidAsync("alert", "Please enter guest name and phone number.");
                return;
            }

            // Prepare data for API
            reservation.Bdate = bookingDate;
            reservation.Btime = bookingTime?.ToString(@"hh\:mm");
            reservation.Gcode = Guid.NewGuid().ToString().Substring(0, 6).ToUpper();
            reservation.SesId = GetSessionType();

            // Post to API
            var response = await Http.PostAsJsonAsync("api/CSATSU_RMS_TABLE_RESERVE", reservation);
            var result = await response.Content.ReadAsStringAsync();

            await JS.InvokeVoidAsync("alert", result);
            Navigation.NavigateTo($"/menu/{OutletId}", forceLoad: true);
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"Error: {ex.Message}");
        }
    }

    private string GetSessionType()
    {
        if (isBreakfast) return "Breakfast";
        if (isLunch) return "Lunch";
        if (isDinner) return "Dinner";
        return "General";
    }
}


<style>
    /* ===== Full Page Wrapper ===== */
    .reservation-wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
        background: linear-gradient(135deg, #eef2f7, #f8fbff);
        overflow: hidden;
        padding-bottom: 2rem;
    }

    /* ===== Header ===== */
    .reservation-header {
        background: linear-gradient(90deg, #0078ff, #00b4d8);
        color: white;
        text-align: center;
        padding: 1rem;
        margin: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

        .reservation-header h2 {
            margin: 0;
            /* font-size: 1.8rem; */
            font-weight: 700;
            /* letter-spacing: 0.5px; */
            /* margin: 0; */
            font-size: 1.5rem;
        }

        .reservation-header p {
            /* margin: 0.4rem 0 0;
            opacity: 0.95;
            font-size: 1rem; */
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

    /* ===== Main Content ===== */
    .reservation-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.2rem;
        width: 100%;
        padding: 0 15px;
        box-sizing: border-box;
    }

    /* ===== Form Section (Cards) ===== */
    .form-section {
        background: #fff;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
        border: 1px solid #f0f0f0;
        transition: 0.3s ease;
    }

        .form-section:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

    /* ===== Form Rows ===== */
    .form-row {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .two-cols {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    /* ===== Inputs ===== */
    input, textarea {
        border: 1.5px solid #d3d9e3;
        border-radius: 10px;
        padding: 0.8rem 1rem;
        font-size: 1rem;
        transition: all 0.2s ease;
        background-color: #f9fbff;
    }

        input:focus, textarea:focus {
            border-color: #0078ff;
            box-shadow: 0 0 8px rgba(0,120,255,0.25);
            background: #ffffff;
            outline: none;
        }

    textarea {
        resize: none;
    }

    /* ===== Labels ===== */
    label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #333;
    }

    /* ===== Buttons ===== */
    .btn-primary {
        background: linear-gradient(90deg, #6a00ff, #8b4dff);
        color: #fff;
        border: none;
        padding: 0.8rem 1.8rem;
        border-radius: 10px;
        font-weight: 600;
        font-size: 1rem;
        align-self: flex-start;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        transition: 0.2s ease;
    }

        .btn-primary:hover {
            background: linear-gradient(90deg, #5600cc, #7b3cff);
            transform: translateY(-2px);
        }

    .btn-reserve {
        background: linear-gradient(90deg, #0078ff);
        color: white;
        border: none;
        padding: 0.9rem 1.8rem;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        align-self: flex-end;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: 0.2s ease;
    }

        .btn-reserve:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.2);
        }

    /* ===== Checkboxes ===== */
    .checkbox-row {
        display: flex;
        gap: 1.5rem;
        font-weight: 500;
        margin-top: 0.5rem;
    }

    input[type="checkbox"] {
        transform: scale(1.3);
        accent-color: #0078ff;
        margin-right: 5px;
    }

    /* ===== Section Titles ===== */
    .form-section h3 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
        color: #0078ff;
        font-weight: 700;
        border-bottom: 2px solid #e7f1ff;
        padding-bottom: 0.4rem;
    }

    /* ===== Responsive Design ===== */
    @@media (max-width: 1200px) {
        .reservation-content

    {
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-section {
        padding: 1.2rem;
    }

    }

    @@media (max-width: 992px) {
        .reservation-content

    {
        grid-template-columns: 1fr;
    }

    .reservation-header {
        /* margin: 10px; */
        padding: 0.8rem;
    }

        .reservation-header h2 {
            font-size: 1.3rem;
        }

        .reservation-header p {
            font-size: 0.85rem;
        }

    .form-section {
        padding: 1.2rem;
        border-radius: 12px;
    }

    }

    @@media (max-width: 768px) {
        .reservation-wrapper

    {
        padding-bottom: 1rem;
    }

    .reservation-header {
        /* margin: 8px; */
        padding: 0.8rem;
    }

        .reservation-header h2 {
            font-size: 1.2rem;
        }

        .reservation-header p {
            font-size: 0.8rem;
        }

    .form-section {
        padding: 1rem;
    }

    input, textarea {
        font-size: 0.9rem;
        padding: 0.7rem 0.9rem;
    }

    .btn-primary,
    .btn-reserve {
        font-size: 0.9rem;
        padding: 0.7rem 1.5rem;
    }

    }

    @@media (max-width: 576px) {
        .reservation-header

    {
        text-align: left;
        border-radius: 8px;
    }

    .reservation-header h2 {
        font-size: 1.1rem;
    }

    .reservation-header p {
        font-size: 0.75rem;
    }

    .form-section {
        padding: 0.9rem;
    }

    label {
        font-size: 0.85rem;
    }

    input, textarea {
        font-size: 0.85rem;
    }

    .two-cols {
        grid-template-columns: 1fr;
        gap: 0.6rem;
    }

    .checkbox-row {
        flex-direction: column;
        gap: 0.5rem;
    }

    }
</style>

